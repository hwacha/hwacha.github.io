+++
date = '2025-03-19T14:36:22-07:00'
draft = true
title = 'Playtree Editor UI'
+++
I wanted to create an intuitive, fun UI for making and visualizing complex playtrees. Playtrees are graph structures, so I used [React Flow](https://reactflow.dev/), a library for rendering and interacting with graphs. The editor displays highly customized nodes and edges using React Flow. At the same time, I wanted to keep the playtree data structure, as maintained on the server, as the editor's source of truth. Keeping the React Flow UI synced with the playtree data required a nuanced understanding of React's resolution algorithm: if React cannot determine that a node remains the same from one render to another, for example, it will destroy the underlying HTML and recreate it for the next render. This isn't only a performance issue; in some cases, it will lead to critical UI bugs like losing focus on a text input while typing. I carefully syncronized the central playtree state with the React Flow UI state to ensure a clean data flow while avoiding any UI bugs.

Although many of the rules governing valid playtrees are implicitly enforced by the editor UI, there are some features which must be checked before a playtree is saved. I perform client-side validation before a playtree is saved, which issues warnings to a user when their playtree doesn't have a playroot attached (meaning playback won't start anywhere if they try to play). This playtree is considered valid—it doesn't violate any playtree rules—but the editor still issues a warning on save, as the user most likely didn't intend to make a playtree that doesn't start playback anywhere. The editor also checks if a user's playscopes are valid. Playscopes can't partially overlap other playscopes, or be redundant. A playtree with invalid playscopes can't unambiguously apply scope rules, and so it is invalid as a playtree. When the user tries to save a invalid playtree, an error is reported in the editor and saving is prevented.